<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.0">
  <meta name="author" content="Wilson E. Marcílio Júnior">
  
  <meta name="description" content="RADAR COVID-19 - UNESP atuando no mapeamento de Casos de Coronavírus no interior paulista.">
  <link rel="alternate" hreflang="en-us" href="/coronavirus/">

  <meta name="theme-color" content="#2962ff">  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  <link rel="alternate" href="/coronavirus/index.xml" type="application/rss+xml" title="Wilson E Marcilio Jr">
  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/radar-icon.jpg">
  <link rel="apple-touch-icon" type="image/png" href="/img/radar-icon.jpg">

  <link rel="canonical" href="/coronavirus/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="RADAR COVID-19">
  <meta property="og:url" content="/coronavirus/">
  <meta property="og:title" content="RADAR COVID-19 - UNESP atuando no mapeamento de Casos de Coronavírus no interior paulista.">
  <meta property="og:description" content="UNESP atuando no mapeamento de Casos de Coronavírus no interior paulista."><meta property="og:image" content="/img/radar-icon.png">
  <meta property="twitter:image" content="/img/radar-icon.png"><meta property="og:locale" content="en-us">
  
    
  

  




  


  





  <title>Radar COVID-19</title>


  <script type="text/javascript" src="js/d3.js"></script>


  <style type="text/css">
    
    div.tooltip { 
          position: absolute;     
          text-align: center;     
          width: 120px;          
          height: 120px;         
          padding: 2px;       
          font: 13px sans-serif;    
          background: #fff; 
          border: 1px; 
          border-color: 'black';       
          pointer-events: none;     
    }   

    .title {
        /*font-family: "Times New Roman";*/
        font: 12px;
    }

    .department {
        /*font-family: "Lucida Console", Courier, monospace;*/
        font: 10px;
    }

     .numbers {
        font-family: "Lucida Console", Courier, monospace;
        font: 14px;
    }


     .ticks {
        font-family: "Lucida Console", Courier, monospace;
        font: 16px;
    }

    .note {
        font-family: "Lucida Console", Courier, monospace;
        font: 6px;
    }

    svg {
        border: 1px solid #dfe7f5;
    }


  </style>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/coronavirus">Radar COVID-19</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://www.fct.unesp.br/"><span>FCT - UNESP</span></a>
        </li>


        <!-- <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Teaching</span></a>
        </li> -->

        
        

      

        
      </ul>
    </div>

    <!-- <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
    </ul> -->

  </div>
</nav>


<!-- COLOCAR NO MAPA O SIMBOLO DA UNESP -->

  
<div class="universal-wrapper pt-3">
  
  <!-- <h1 style="text-align: center; width:100%;">RADAR COVID-19</h1> -->
<!--   <div style="text-align: center; width:100%;">
    
  </div> -->
  <img src="radar-icon.jpg" width="300" height="300" style="display: block;
  margin-left: auto;
  margin-right: auto;" />
  <p>O RADAR COVID-19 é uma iniciativa de pesquisadores da Faculdade de Ciências e Tecnologia, Campus de Presidente Prudente da Universidade Estadual Paulista “Júlio de Mesquita Filho” (FCT-UNESP) para análise e mineração de dados do Twitter e de rumores, referente à disseminação do novo coronavírus (COVID-19) no interior paulista. Detalhes acerca dos projetos podem ser encontrados <a href="#detalhes-projetos">aqui</a>.<p>

<ul>
  <li><a href="#analise-espacial">Análise de Redes Sociais e Dados de Busca</a></li>
  <!-- <li><a href="#analise-rumores">Análise de Rumores</a></li> -->
  <li><a href="#pessoas-envolvidas"> Pesquisadores envolvidos</a></li>
</ul>
  
</div>



<div class="universal-wrapper" id="analise-espacial">

  
  <h3>Monitoramento COVID-19 - São Paulo</h3>  
  
  <br/>

  <div class="mainView">

    <h4>Mapa 1: Rumores dos sintomas do COVID-19 considerando <em>tweets</em>.</h4>
    <div>
      <svg id="map-twitter">        
        <foreignobject class="node" x="700" y="5" width="300" height="150">                
            <label id="progressionTwitter" class="title">Dia: 31/mar</label><br/>
            <button id="twitter-back"><<</button>     <button id="twitter-front" style="margin-left: 10px;">>></button> <br>

            <input type="range" id="dateTwitter" name="dateTwitter" class="progressionRange" value="0">   
        </foreignobject>

      </svg>
    </div>

    <br/>
    <br/>

    <h4>Mapa 2: Casos confirmados por cidade no Estado de São Paulo.</h4>
    <div>
      <span style="font: 6px;">* As informações apresentadas são de origem pública, obtidas por meio de veículos de comunicação e da Secretaria do Estado de São Paulo***.</span><br/>
      <span style="font: 6px;">** Última atualização: 01/04/2020 às 10h59.</span>
    </div>
    <div>
      <svg id="map-covid">        
        <foreignobject class="node" x="700" y="5" width="300" height="150">                
            <label id="titleProgression" class="title">Dia: 31/mar</label><br/>
            <button id="progression-back"><<</button>     <button id="progression-front" style="margin-left: 10px;">>></button> <br>
            <input type="range" id="realProgression" name="realProgression" class="progressionRange" value="0">   
        </foreignobject>

      </svg>
    </div>

    <br/>
    <br/>

    <!-- <h4>Evolução dos casos ao longo do tempo</h4>
    <div>
      <svg id="statisticalCharts"></svg>
    </div>

    <br/>
    <br/> -->

    <h4>Mapa 3: Resultado de pesquisas no Google considerando os sintomas do COVID-19.</h4>
    <div>
      <svg id="map-google">
          <foreignobject class="node" x="727" y="230" width="200" height="150">                
               <label id="progressionGoogleTrends" class="title">Dia: 31/mar</label><br/>
               <button id="google-back"><<</button>     <button id="google-front" style="margin-left: 10px;">>></button> <br>
               <input type="range" id="dateGoogleTrends" name="dateGoogleTrends" class="progressionRange" value="0">
          </foreignobject>
      </svg>
    </div>

  </div>


</div>


<!-- <div class="universal-wrapper" id="analise-rumores">
  <h1>Análise de rumores</h1>  
  <p>Página será lançada em breve.</p>
</div> -->

<div class="universal-wrapper" id="pessoas-envolvidas">

    
    <h1>Pesquisadores envolvidos</h1>  

    



    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/rogerio.jpg" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">Prof. Dr. Rogério Eduardo Garcia</a></h5>
          <h6 class="card-subtitle">Departamento de Matemática e Computação - FCT/UNESP</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:rogerio.garcia@unesp.com" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://www.researchgate.net/profile/Rogerio_Garcia" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://scholar.google.com.br/citations?user=F6DXOMQAAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li>
              
                <li>
                  <a href="https://orcid.org/0000-0003-1248-528X" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li>             
          </ul>

        </div>
    </div>

    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/danilo.jpg" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">Prof. Dr. Danilo Medeiros Eler</a></h5>
          <h6 class="card-subtitle">Departamento de Matemática e Computação - FCT/UNESP</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:danilo.eler@unesp.com" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://www.researchgate.net/profile/Danilo_Eler" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://scholar.google.com.br/citations?user=p5mxNX8AAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li>
              
                <li>
                  <a href="http://orcid.org/0000-0002-9493-145X" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li>

                <li>
                  <a href="https://github.com/daniloeler" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                  </a>
                </li>
              
          </ul>

        </div>
    </div>

    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/ronaldo.jpg" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">Prof. Dr. Ronaldo Celso Messias Correia</a></h5>
          <h6 class="card-subtitle">Departamento de Matemática e Computação - FCT/UNESP</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:ronaldo.correia@unesp.br" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://www.researchgate.net/profile/Ronaldo_Correia" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li>
            
                <!-- <li>
                  <a href="https://scholar.google.com/citations?user=-KvJBfcAAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li> -->
              
                <li>
                  <a href="http://orcid.org/0000-0002-8044-7333" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li>
            
          </ul>

        </div>
    </div>

    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/carlos.gif" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">Prof. Dr. Carlos Magno Castelo Branco Fortaleza</a></h5>
          <h6 class="card-subtitle">Faculdade de Medicina (Câmpus de Botucatu)</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:carlos.fortaleza@unesp.br" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
                <!-- <li>
                  <a href="https://www.researchgate.net/profile/Raul_Guimaraes" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li> -->
            
                <li>
                  <a href="https://scholar.google.com.br/citations?user=hbSM8agAAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li>
              
                <li>
                  <a href="https://orcid.org/0000-0003-4120-1258" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li>             
          </ul>

        </div>
    </div>

    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/raul.jpg" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">Prof. Titular Raul Borges Guimarães</a></h5>
          <h6 class="card-subtitle">Departamento de Geografia - FCT/UNESP</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:raul.guimaraes@unesp.com" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://www.researchgate.net/profile/Raul_Guimaraes" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://scholar.google.com.br/citations?user=vGZaRYEAAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li>
              
                <li>
                  <a href="https://orcid.org/0000-0002-9925-5374" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li>             
          </ul>

        </div>
    </div>

    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/avatar_hue102bab58b683d05ea725ccd34a293b1_11390_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">MSc. Wilson Estécio Marcílio Júnior</a></h5>
          <h6 class="card-subtitle">Doutorando em Ciência da Computação</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:wilson.marcilio@unesp.com" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://www.researchgate.net/profile/Wilson_Estecio_Marcilio_Junior" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://scholar.google.com/citations?user=-KvJBfcAAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li>
              
                <li>
                  <a href="https://orcid.org/0000-0002-8580-2779" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://github.com/wilsonjr" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                  </a>
                </li>       
          </ul>

        </div>
    </div>


    <div class="media author-card content-widget-hr">
        
          
        <img class="portrait mr-3" src="/authors/admin/rafael.jpg" alt="Avatar">
        

        <div class="media-body">
          <h5 class="card-title"><a href="#">Rafael Bezerra de Menezes Rodrigues</a></h5>
          <h6 class="card-subtitle">Mestrando em Ciência da Computação</h6>
          <ul class="network-icon" aria-hidden="true">
                <li>
                  <a href="mailto:rafael.rodrigues@unesp.br" >
                    <i class="fas fa-envelope"></i>
                  </a>
                </li>
            
               <!--  <li>
                  <a href="https://www.researchgate.net/profile/Wilson_Estecio_Marcilio_Junior" target="_blank" rel="noopener">
                    <i class="ai ai-researchgate"></i>
                  </a>
                </li>
            
                <li>
                  <a href="https://scholar.google.com/citations?user=-KvJBfcAAAAJ" target="_blank" rel="noopener">
                    <i class="ai ai-google-scholar"></i>
                  </a>
                </li>
              
                <li>
                  <a href="https://orcid.org/0000-0002-8580-2779" target="_blank" rel="noopener">
                    <i class="ai ai-orcid"></i>
                  </a>
                </li> -->
            
                <li>
                  <a href="https://github.com/RafaelBMR" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                  </a>
                </li>       
          </ul>

        </div>
    </div>

    <div class="article-widget content-widget-hr">
    <h3>Dados</h3>
    <ul>
      
      <li>*** <a href="https://github.com/wcota/covid19br"> COVID19BR</a></li>
      <li>*** <a href="https://www.seade.gov.br/coronavirus/"> SAEDE</a></li>
      
    </ul>
  </div>
</div>


<div class="universal-wrapper" id="detalhes-projetos">
   <h1>O que estamos fazendo?</h1>  

  <p>
Duas pesquisas estão em desenvolvimento, frente a atual situação da disseminação do novo coronavírus: uma das pesquisas foca na análise e mineração de dados de redes sociais e a outra na análise de dados de rumores. Com as redes sociais (Twitter, mais precisamente), tem-se como foco a análise da publicação de notas, que pode ajudar a encontrar possíveis novos focos de disseminação de COVID-19. Dessa maneira, tweets são analisados diariamente de acordo com sua relevância para ajudar na busca por novos focos de COVID-19. Considerando a informação de casos confirmados de coronavírus no Estado de São Paulo, a localização dos tweets ajuda na análise de possíveis focos de disseminação do novo coronavírus.
</p>

<p>
  O applicativo para coleta de dados de rumores será lançado em breve!
</p>


</div>


    <script type="text/javascript">


      let tooltip = d3.select('body').append('div')
          .attr('class', 'tooltip')
          .style('opacity', 0);

      let unesps = ['Araçatuba','Araraquara','Assis','Bauru','Botucatu','Dracena','Franca','Guaratinguetá','Ilha Solteira','Itapeva','Jaboticabal','Marília','Ourinhos','Presidente Prudente','Registro','Rio Claro','Rosana','São João da Boa Vista','São José do Rio Preto','São José dos Campos','São Paulo','São Vicente','Sorocaba','Tupã'];

      for (var i = 0; i < unesps.length; i++) {
          unesps[i] = unesps[i].replace(/[^\x00-\x7F]/g, "");
      }

      let width = 900;
      let height = 750;

      let casosByCity = null;
      let googleTrendsMap = null;
      let colors = null;
      let colorTrends = null;
      let termTrends = null;
      let subsetGoogleTrendsMap = null;
      let allTweets = null;
      let cityById = null;

      let googleDayMax = 0;
      let googleDay = 0;

      let progressionDayMax = 0;
      let progressionDay = 0;

      let twitterDayMax = 0;
      let twitterDay = 0;


      let store = {};

      let months = {
          '0': 'January',
          '1': 'February',
          '2': 'March',
          '3': 'April',
          '4': 'May',
          '5': 'June',
          '6': 'July',
          '7': 'August',
          '8': 'September',
          '9': 'October',
          '10': 'November',
          '11': 'December'
      };

      let map_month = {
          'fev': 2,
          'mar': 3,
          'abr': 4,
          'mai': 5,
          'jun': 6,
          'jul': 7,
          'ago': 8,
          'set': 9,
          'out': 10,
          'nov': 11,
          'dez': 12
      };

      let number_to_month = {
        0: 'jan',
        1: 'fev',
        2: 'mar',
        3: 'abr',
        4: 'mai',
        5: 'jun',
        6: 'jul',
        7: 'ago',
        8: 'set',
        9: 'out',
        10: 'nov',
        11: 'dez'
      }




      loadData().then(showData);

      function drawBaseMapReal(container, countries, projection, geoJson, subset, update) {
          let backup = null;

          if( subset != null ) {
              backup = casosByCity;
              casosByCity = subset;
          } else {

              backup = casosByCity;

              casosByCity = backup.filter(d => d.date.getTime() == lastDate.getTime());
          }

          current = casosByCity;
          let max_casos = d3.max(casosByCity, d => d.casos);


          let path = d3.geoPath()
              .projection(projection);

          if( !update ) {
              container.selectAll('path')
                  .data(countries)
                  .enter().append('path')
                  .attr('d', d => { return path(d); })
                  .on('mouseover', d => {
                      tooltip.transition()
                          .duration(200)
                          .style('opacity', .9);

                      let value = 0;

                      let name = d.properties.name.replace(/[^\x00-\x7F]/g, "");

                      for (var i = 0; i < current.length; i++) {
                          let cityName = current[i]['cidade'].replace(/[^\x00-\x7F]/g, "");
                          if( cityName.trim() == name.trim() ) {
                              value = current[i]['casos'];
                              break;
                          }
                      }
                      tooltip.html("<p>"+d.properties.name+"</p>"+
                                  "<p>"+value+" caso(s) confirmados.</p>")
                          .style('left', (d3.event.pageX)+'px')
                          .style('top', (d3.event.pageY - 28)+'px');
                  })
                  .on('mouseout', d => {
                      tooltip.transition()
                          .duration(500)
                          .style('opacity', 0);
                  });


          } 

          // container.selectAll('path').remove();
          
          container.selectAll('path')
            .transition()
            .duration(update ? 1000 : 0)
              .style('stroke', '#ccc')
              .style('stroke-width', 1)
              .style('fill', d => { 
                  let value = 0;
                  if( value == 0 )
                      return '#eee';

                  return d3.interpolateReds(value/max_casos);
              });


          let scaleArea = d3.scaleLinear()
              .domain([d3.min(backup, d => +d.casos), d3.max(backup, d => +d.casos)])
              .range([5, 20]);


          let g = null;
          if( !update ) {
              g = container.append('g')
                  .attr('class', 'real_cases');     

              let g_legend = container.append('g')
                  .attr('transform', 'translate(0,0)');   

              let max = 4;
              let step = (d3.max(backup, d => +d.casos) - d3.min(backup, d => +d.casos))/max;

              g_legend.append('circle')
                  .attr('cx', d => 45)
                  .attr('cy', d => 50)
                  .attr('r', scaleArea(1))
                  .style('fill', '#eb4034')
                  .style('fill-opacity', 0.2)
                  .style('stroke', '#eb4034')
                  .style('stroke-opacity', 0.8);  

              g_legend.append('text')
                      .attr('x', d => 45)
                      .attr('y', d => 50 + scaleArea(4*step) + 20)
                      .attr('text-anchor', 'middle')
                      .attr('class', 'numbers')
                      .text('1');
              let r_before = scaleArea(1);
              let x_before = 45;
              for( let  i = 1; i <= max; i++ ) {

                  let r = scaleArea(i*step);
                  g_legend.append('circle')
                      .attr('cx', d => x_before + r_before + 20 + r)
                      .attr('cy', d => 50)
                      .attr('r', r)
                      .style('fill', '#eb4034')
                      .style('fill-opacity', 0.2)
                      .style('stroke', '#eb4034')
                      .style('stroke-opacity', 0.8);  

                  g_legend.append('text')
                      .attr('x', d => x_before + r_before + 20 + r)
                      .attr('y', d => 50 + scaleArea(4*step) + 20)
                      .attr('text-anchor', 'middle')
                      .style('font', '14px')
                      .style('font-family', 'Times New Roman')
                      .text(Math.floor(i*step));

                  r_before = r;
                  x_before = x_before + r_before + 20 + r;

              }
              g_legend.append('text')
                      .attr('x', d => 35)
                      .attr('y', d => 20)
                      .style('font', '14px')
                      .style('font-family', 'Times New Roman')
                      .attr('text-anchor', 'start')
                      .text('CASOS CONFIRMADOS');


              let g_description = container.append('g')
                  .attr('transform', 'translate(10,650)');   

              addUnespDescription(g_description);

          } else {
              g = container.select('.real_cases');
          }

          
          
          let circle = g.selectAll('circle')
              .data(current, d => d.cidade);

          circle.exit().remove();

          circle.enter().append('circle')
              .attr('cx', d => projection([d.long, d.lat])[0])
              .attr('cy', d => projection([d.long, d.lat])[1])
              .style('fill', '#eb4034')
              .style('fill-opacity', 0.2)
              .style('stroke', '#eb4034')
              .style('stroke-opacity', 0.8)
            .merge(circle)
              .transition()
              .duration(500)
                .attr('r', d => scaleArea(+d.casos));
          
              
          if( backup != null ) {
              casosByCity = backup;
          }
      }

      function drawStatisticalCharts(store) {
          let geoJson = store.geoJSON;
          let evolucao = store.evolucao;

          for (var i = 0; i < evolucao.length; i++) {
              evolucao[i].evolucao = +evolucao[i].evolucao;
              evolucao[i].casos_dia = +evolucao[i].casos_dia;

              let date_string = evolucao[i].data.split('/');
              let day = +date_string[0];

              let month = map_month[date_string[1]];

              let date = new Date(2020, month-1, day);

              evolucao[i].date = date;
          }

          let legends = d3.select("#statisticalCharts")
              .attr('width', 900)
              .attr('height', 500);

          g_evolucao = legends.append('g')
              .attr('transform', 'translate(50, 50)');


          let height_graph = 300;
          let width_graph = 800;

          let yScaleEvolucao = d3.scaleLinear()
              .domain([0, d3.max(evolucao, d => d.evolucao)])
              .range([height_graph, 0]);

          let yAxisEvolucao = d3.axisLeft()
              .scale(yScaleEvolucao)
              .ticks(5);

          g_evolucao.append('g')
              .style('stroke-width', 1.5)
              .attr('class', 'ticks')
              .attr('transform', 'translate(0,'+yScaleEvolucao(d3.max(evolucao, d => d.evolucao))+')')
              .call(yAxisEvolucao);


          let xScaleEvolucao = d3.scaleTime()
              .domain([evolucao[0].date, evolucao[evolucao.length-1].date])
              .range([0, width_graph]);

          let xAxisEvolucao = d3.axisBottom()
              .scale(xScaleEvolucao);


          g_evolucao.append('g')
              .style('stroke-width', 1.5)
              .attr('class', 'tick_values')
              .attr('transform', 'translate(0,'+yScaleEvolucao(0)+')')
              .call(xAxisEvolucao)
            .selectAll("text")
              .attr("y", 0)
              .attr("x", 25)
              .attr("dy", ".35em")
              .attr('class', 'ticks')
              .style("text-anchor", "start")
              .attr("transform", "rotate(90)");

          let line_evolucao = d3.line()
              .x((d, i) => xScaleEvolucao(d.date))
              .y(d => yScaleEvolucao(d.evolucao))
              .curve(d3.curveCardinal.tension(0.5));

          g_evolucao.append('path')
              .attr('d', line_evolucao(evolucao))
              .attr('stroke', '#ff0000')
              .attr('stroke-width', 3)
              .attr('fill', 'none');

          g_evolucao.append('text')
              .attr('x', width_graph/2)
              .attr('y', -yScaleEvolucao(d3.max(evolucao, d => d.evolucao))-20)
              .attr('text-anchor', 'middle')
              .attr('class', 'title')
              .text('Casos confirmados no Estado de São Paulo');



          // draw new cases per day
          let line_novos = d3.line()
              .x((d, i) => xScaleEvolucao(d.date) )
              .y(d => yScaleEvolucao(d.casos_dia))
              .curve(d3.curveCardinal.tension(0.5));

          g_evolucao.append('path')
              .attr('d', line_novos(evolucao))
              .attr('stroke', '#000000')
              .attr('stroke-width', 3)
              .attr('fill', 'none');



          // drawing legends

          g_evolucao.append('circle')
              .attr('cx', 30)
              .attr('cy', 5)
              .attr('r', 5)
              .style('fill', '#ff0000')
              .style('stroke', 'none');


          g_evolucao.append('circle')
              .attr('cx', 30)
              .attr('cy', 25)
              .attr('r', 5)
              .style('fill', '#000000')
              .style('stroke', 'none');


          g_evolucao.append('text')
              .attr('x', 40)
              .attr('y', 10)
              .attr('class', 'numbers')
              .text('Infectados');

          g_evolucao.append('text')
              .attr('x', 40)
              .attr('y', 30)
              .attr('class', 'numbers')
              .text('Novos casos');

      }

      function drawMapReal(geoJSON) {
          let config = getMapConfig('#map-covid');
          let projection = getMapProjection(config, geoJSON);

          configMapReal = config;
          projectionMapReal = projection;
          geoJson = geoJSON;
         drawBaseMapReal(config.container, geoJSON.features, projection, geoJSON, null);
      }

      function drawMapGoogleTrends(container, countries, projection, geoJson, color, symptom) {

          let path = d3.geoPath()
              .projection(projection);

          let paths = container.selectAll('path')
            .data(countries, d => d.id);

          paths.exit().remove();

          container.selectAll('path').style('fill-opacity', 0);

          paths.enter().append('path')
              .attr('d', d => { return path(d); })
              .style('stroke', '#ccc')
              .style('stroke-width', 1)
              .style('fill-opacity', 0)
              // .transition()
              // .duration(2000)
              //     .style('fill-opacity', 0)                    
              .transition()
              .duration(1000)
                  .style('fill', color)
                  .style('fill-opacity', (d, j) => { 
                      let value = 0;

                      for( let i = 0; i < subsetGoogleTrendsMap.length; i++) {
                          if( subsetGoogleTrendsMap[i].Cidade.trim().replace(/[^\x00-\x7F]/g, "") == d.properties.name.trim().replace(/[^\x00-\x7F]/g, "") ) {
                              value = subsetGoogleTrendsMap[i][symptom];
                              break;
                          }
                      }

                      let opacity =  value == 0 ? 0 : value/d3.max(subsetGoogleTrendsMap, v => v[symptom]);

                      return opacity;
                  });
      }

      function addUnespDescription(g) {

        console.log('adding description');

        g.append('image')
          .attr('x', 0)
          .attr('y', -70)
          .attr('xlink:href', 'unesp.svg')
          .attr('width', 120)
          .attr('height', 50)

        g.append('text')
          .attr('x', 0)
          .attr('y', 0)
          .attr('text-anchor', 'start')
          // .attr('class', 'title')
          .style('font-size', '14px')
          .style('font-family', 'Times New Roman')
          .text('UNIVERSIDADE ESTADUAL PAULISTA')
        g.append('text')
          .attr('x', 0)
          .attr('y', 17)
          .attr('text-anchor', 'start')
          .style('font-size', '14px')
          .style('font-family', 'Times New Roman')
          .text('"JÚLIO MESQUITA FILHO"')

        g.append('text')
          .attr('x', 0)
          .attr('y', 40)
          .attr('text-anchor', 'start')
          .style('font-size', '13px')
          .style('font-family', 'Times New Roman')
          .text('Departamento de Matemática e Computação - DMC')

        g.append('text')
          .attr('x', 0)
          .attr('y', 56)
          .attr('text-anchor', 'start')
          .style('font-size', '13px')
          .style('font-family', 'Times New Roman')
          .text('Campus de Presidente Prudente')

      }

      function drawGoogleTrendsLegend(container) {
          // container.select('.twitter_colorscale')
          //     .selectAll('*')
          //     .transition()
          //     .duration(2000)
          //         .style('fill-opacity', 0);

          container.append("text")
            .attr('x', 805)
            .attr('y', 15)
            .attr('text-anchor', 'middle')
            .style('font-family', 'Times New Roman')
            .style('font', '16px')
            .text('Clique no círculo para')

          container.append("text")
            .attr('x', 805)
            .attr('y', 35)
            .attr('text-anchor', 'middle')
            .style('font-family', 'Times New Roman')
            .style('font', '16px')
            .text('mudar de sintoma')

          let g_density = container.append('g')  
              .attr('class', 'g_density')
              .attr('transform', 'translate(10, 25)');

          let scaleWidth = 300;
          let colorScale = d3.scaleSequential(d3.interpolateGreys)
              .domain([0, scaleWidth*2]);

          let bars = g_density.selectAll(".bars")
              .data(d3.range(scaleWidth*2), function(d) { return d; })
            .enter().append("rect")
              .attr("class", "bars")
              .attr("x", d => d/2.0)
              .attr("y", 0)
              .attr("height", 20)
              .attr("width", 1)
              .style("fill", function(d, i ) { return colorScale(d); })
              .style('stroke-opacity', 0);

          g_density.append('text')
            .attr('x', 0)
            .attr('y', 38)
            .attr('text-anchor', 'start')
            .style('font-family', 'Times New Roman')
            .style('font', '14px')
            .text('Sem interesse');

          g_density.append('text')
            .attr('x', scaleWidth)
            .attr('y', 38)
            .attr('text-anchor', 'end')
            .style('font-family', 'Times New Roman')
            .style('font', '14px')
            .text('Maior interesse');

          g_density.append('text')
            .attr('x', scaleWidth/2)
            .attr('y', -8)
            .attr('text-anchor', 'middle')
            .style('font-family', 'Times New Roman')
            .style('font', '16px')
            .text('INTERESSE NO SINTOMA');


          let trends_legend = container.append('g')  
              .attr('class', 'trends_legend')
              .attr('transform', 'translate(750, 50)');

          let googleTrends = googleTrendsMap.columns.slice(2, 7);

          for( let i = 0; i < googleTrends.length; i++ ) {

              trends_legend.append('circle')
                  .attr('cx', 0)
                  .attr('cy', i * 30 + 10)
                  .attr('r', 7)
                  .style('fill', termTrends == googleTrends[i] ? colors(googleTrends[i]) : 'gray')
                  .on('click', function() {
                      colorTrends = colors(googleTrends[i]);
                      termTrends = googleTrends[i];

                      trends_legend.selectAll('circle').style('fill', 'gray');                      
                      d3.select(this).style('fill', colorTrends);
                      drawGoogleTrends(colors(googleTrends[i]), googleTrends[i]);
                  });


              trends_legend.append('text')
                  .attr('x',  12)
                  .attr('y', i * 30 + 5 + 10)
                  .text(googleTrends[i]);
          }

          // trends_legend.append('text')
          //     .attr('x', -7)
          //     .attr('y', 10)
          //     .text('Google Trends');

          trends_legend.append('rect')
              .attr('x', -20)
              .attr('y', -10)
              .attr('width', 150)
              .attr('height', 180)
              .style('stroke', 'black')
              .style('fill', 'none');
      }

      function drawGoogleTrends(color, symptom) {
          let config = getMapConfig("#map-google");
          let projection = getMapProjection(config, geoJson);

          drawMapGoogleTrends(config.container, geoJson.features, projection, geoJson, color, symptom);
      }

      function groupByCityName(data) {
          let result = data.reduce((result, d) => {
              let currentDest = result[d.cidade.split('-')[0].replace(/[^\x00-\x7F]/g, "")] || {
                  'cidade': d.cidade,
                  'lat': +d.lat,
                  'long': +d.long,
                  'Count': 0
              };

              currentDest.Count += 1;
              
              result[d.cidade.split('-')[0].replace(/[^\x00-\x7F]/g, "")] = currentDest;
              return result;
          }, {});

          result = Object.keys(result).map(key => result[key]);
          return result;
      }

      function drawSubsetTweets(tweets, store, update) {
          let geoJson = store.geoJSON;
          let evolucao = store.evolucao;


          let config = getMapConfig('#map-twitter');
          let projection = getMapProjection(config, geoJson);
          let container = config.container;
          let states = geoJson.features;
          let g_legend = null;

          if( !update ) {
              let path = d3.geoPath()
                  .projection(projection);
    
              let paths = container.selectAll('path')
                .data(states, d => d.id);
    
              paths.exit().remove();
              paths.enter().append('path')
                  .attr('d', d => { return path(d); })
                  .style('stroke', '#ccc')
                  .style('stroke-width', 1)
                  .style('fill-opacity', 0)
                  .on('mouseover', d => {

                      tooltip.transition()
                          .duration(200)
                          .style('opacity', .9);

                      let value = 0;

                      let name = d.properties.name.replace(/[^\x00-\x7F]/g, "");

                      for (var i = 0; i < tweets.length; i++) {
                          let cityName = tweets[i]['cidade'].split('-')[0].replace(/[^\x00-\x7F]/g, "");
                          if( cityName.trim() == name.trim() ) {
                              value++;
                          }
                      }
                      tooltip.html("<p>"+d.properties.name+"</p>"+
                                  "<p>"+value+" tweet(s).</p>")
                          .style('left', (d3.event.pageX)+'px')
                          .style('top', (d3.event.pageY - 28)+'px');
                  })
                  .on('mouseout', d => {
                      tooltip.transition()
                          .duration(500)
                          .style('opacity', 0);
                  });


              let g_description = container.append('g')
                  .attr('transform', 'translate(10,650)');  
              addUnespDescription(g_description);


              g_legend = container.append('g')
                .attr('transform', 'translate(10, 30)');


              //  g_density.append('text')
              //   .attr('x', 0)
              //   .attr('y', -5)
              //   .attr('text-anchor', 'start')
              //   .style('font-family', 'Times New Roman')
              //   .style('font', '14px')
              //   .text('Número de tweets');


              // let elements = [1, 5, 15];

              // for( let i = 0; i < elements.length; ++i ) {

              //   for( let j = 0; j < elements[i]; ++j ) {
              //     g_density.append('rect')
              //       .attr('x', i*50)
              //       .attr('y', 0)
              //       .attr('width', 45)
              //       .attr('height', 45)
              //       .style('fill', 'red')
              //       .style('fill-opacity', 0.1)
              //       .style('stroke', 'none');
              //   }

              //   g_density.append('text')
              //     .attr('x', i*50 + 45/2)
              //     .attr('y', 63)
              //     .attr('text-anchor', 'middle')
              //     .style('font-family', 'Times New Roman')
              //     .style('font', '14px')
              //     .text(elements[i] == 15 ? '+15' : elements[i]);


              // }


              




              // let scaleWidth = 300;
              // let colorScale = d3.scaleSequential(d3.interpolateReds)
              //     .domain([0, scaleWidth*2]);

              // let bars = g_density.selectAll(".bars")
              //     .data(d3.range(scaleWidth*2), function(d) { return d; })
              //   .enter().append("rect")
              //     .attr("class", "bars")
              //     .attr("x", d => d/2.0)
              //     .attr("y", 0)
              //     .attr("height", 20)
              //     .attr("width", 1)
              //     .style("fill", function(d, i ) { return colorScale(d); })
              //     .style('stroke-opacity', 0);

              // g_density.append('text')
              //   .attr('x', 0)
              //   .attr('y', 25)
              //   .attr('text-anchor', 'start')
              //   .style('font-family', 'Times New Roman')
              //   .style('font', '14px')
              //   .text('max');

              
          }

          let g = null;
          if( !update ) {
              g = container.append('g')
                  .attr('class', 'tweets_geo');
          } else {
              g = container.select('.tweets_geo');
          }


          // console.log('meus tweets');
          // console.log(tweets);

          // let tweetsById = groupByCityId(tweets);
          // console.log('tweets by id');
          // console.log(tweetsById);



          // console.log('min: '+d3.min(tweetsById, d => d.Count));
          // console.log('max: '+d3.max(tweetsById, d => d.Count));

          let groupedCities = groupByCity(tweets);
          console.log('groupedCities');
          console.log(groupedCities);

          let groupedCitiesName = groupByCityName(tweets);
          console.log('groupedCitiesName');
          console.log(groupedCitiesName);
          // groupedCitiesName = groupedCitiesName.filter(d => d.cidade.split('-')[0].replace(/[^\x00-\x7F]/g, "") != "São Paulo".replace(/[^\x00-\x7F]/g, ""))


          let scaleArea = d3.scaleLinear()
              .domain([Math.log(d3.min(groupedCitiesName, d => d.Count)), Math.log(d3.max(groupedCitiesName, d => d.Count))])
              .range([5, 15]);

          let circle = g.selectAll('circle')
              .data(groupedCitiesName, d => d.cidade.split('-')[0].replace(/[^\x00-\x7F]/g, ""));

          circle.exit().remove();

          circle.enter().append('circle')    
              .attr('cx', d => projection([d.long, d.lat])[0]
              // { 
              //     if( Math.floor(Math.random() * 2) + 1 ) {
              //         let jitter_x = Math.floor(Math.random() * 10) + 1;
              //         return projection([d.long, d.lat])[0] + jitter_x;
              //     } else {
              //         let jitter_x = -(Math.floor(Math.random() * 10) + 1);
              //         return projection([d.long, d.lat])[0] + jitter_x;
              //     }
              // }
              )
              .attr('cy', d => projection([d.long, d.lat])[1]
              // { 
              //     if( Math.floor(Math.random() * 2) + 1 ) {
              //         let jitter_y = Math.floor(Math.random() * 10) + 1;
              //         return projection([d.long, d.lat])[1] + jitter_y;
              //     } else {
              //         let jitter_y = -(Math.floor(Math.random() * 10) + 1);
              //         return projection([d.long, d.lat])[1] + jitter_y;
              //     }
              // }
              )
              .style('fill', '#eb4034')
              .style('fill-opacity', 0.3)
              .style('stroke','#eb4034' )
              .style('stroke-opacity', 0.8)
              .on('click', (d, i) => {
                  d3.select('#tweet')
                      .html('<p>'+d.text+'</p>')
              })
            .merge(circle)
              .transition()
              .duration(500)
                  // .attr('r', 5)
                .attr('r', d => {
                  // console.log(d.Count+ ", "+Math.log(d.Count)+": "+scaleArea(Math.log(d.Count)));
                  return scaleArea(Math.log(d.Count));
                });

          if( !update ) {

              let max = 4;
              let step = (d3.max(groupedCitiesName, d => d.Count) - d3.min(groupedCitiesName, d => d.Count))/max;


              g_legend.append('text')
                .attr('x', d => 10 - scaleArea(Math.log(d3.min(groupedCitiesName, d => d.Count))))
                .attr('y', d => 20)
                .attr('text-anchor', 'start')
                .style('font', '16px')
                .style('font-family', 'Times New Roman')
                .text('NÚMERO DE TWEETS'); 

              g_legend.append('circle')
                .attr('cx', d => 10)
                .attr('cy', d => 50)
                .attr('r', scaleArea(Math.log(d3.min(groupedCitiesName, d => d.Count))))
                .style('fill', '#eb4034')
                .style('fill-opacity', 0.2)
                .style('stroke', '#eb4034')
                .style('stroke-opacity', 0.8); 

              g_legend.append('text')
                  .attr('x', d => 10)
                  .attr('y', d => 50 + scaleArea(Math.log(4*step)) + 20)
                  .attr('text-anchor', 'middle')
                  .style('font', '14px')
                  .style('font-family', 'Times New Roman')
                  .text(d3.min(groupedCitiesName, d => d.Count)); 

              let r_before = scaleArea(1);
              let x_before = 10;
              

              for( let  i = 1; i <= max; i++ ) {

                  let r = scaleArea(Math.log(i*step));
                  g_legend.append('circle')
                      .attr('cx', d => x_before + r_before + 20 + r)
                      .attr('cy', d => 50)
                      .attr('r', r)
                      .style('fill', '#eb4034')
                      .style('fill-opacity', 0.2)
                      .style('stroke', '#eb4034')
                      .style('stroke-opacity', 0.8);  

                  g_legend.append('text')
                      .attr('x', d => x_before + r_before + 20 + r)
                      .attr('y', d => 50 + scaleArea(Math.log(4*step)) + 20)
                      .attr('text-anchor', 'middle')
                      .style('font', '14px')
                      .style('font-family', 'Times New Roman')
                      .text(Math.floor(i*step));

                  r_before = r;
                  x_before = x_before + r_before + 20 + r;

              }
          }
      }

      function showData() {

          let tweets = store.tweets;
          cityById = groupByCity(tweets);

          let last_date = new Date(2020, 1, 27);
          for( let i = 0; i < tweets.length; ++i ) {
            let temp = tweets[i].date.split(" ")[0].split("-");
            let date = new Date(+temp[0], +temp[1] - 1, +temp[2]);

            tweets[i].date_object = date;
            tweets[i].lat = +tweets[i].lat;
            tweets[i].long = +tweets[i].long;
            tweets[i].id = i;

            if( last_date < tweets[i].date_object ) {
                last_date = tweets[i].date_object;
            }
          }          
          let subsetTwitter = tweets.filter(d => d.date_object.getDay() == last_date.getDay() &&
                                                 d.date_object.getMonth() == last_date.getMonth() &&
                                                 d.date_object.getYear() == last_date.getYear());


          let distinctDatesTwitter = [...new Set(tweets.map(d => d.date.split(" ")[0]))];
          document.getElementById('dateTwitter').max = distinctDatesTwitter.length-1;
          document.getElementById('dateTwitter').value = distinctDatesTwitter.length-1;
          twitterDayMax = distinctDatesTwitter.length-1;
          twitterDay = distinctDatesTwitter.length-1;
          document.getElementById('twitter-front').disabled = true;          


          let distinctDates = [...new Set(casosByCity.map(d => d.data))];
          document.getElementById('realProgression').max = distinctDates.length-1;
          document.getElementById('realProgression').value = distinctDates.length-1;
          progressionDayMax = distinctDates.length-1;
          progressionDay = distinctDates.length-1;
          document.getElementById('progression-front').disabled = true;          

          let maxValue = [...new Set(googleTrendsMap.map(d => d.ate))].length-1;
          document.getElementById('dateGoogleTrends').max = maxValue;
          document.getElementById('dateGoogleTrends').value = maxValue;
          googleDayMax = maxValue;
          googleDay = maxValue;
          document.getElementById('google-front').disabled = true;


          allTweets = tweets;
          drawSubsetTweets(subsetTwitter, store, false);

          drawMapReal(store.geoJSON);
          // drawStatisticalCharts(store);
         

          let g_description = getMapConfig("#map-google").container.append('g')
              .attr('transform', 'translate(10,650)');   
          addUnespDescription(g_description);


          colorTrends = colors(googleTrendsMap.columns[2]);
          termTrends = googleTrendsMap.columns[2];
           drawGoogleTrendsLegend(getMapConfig("#map-google").container);
          drawGoogleTrends(colors(googleTrendsMap.columns[2]), googleTrendsMap.columns[2]);
      } 

      function groupByCity(data) {
          let result = data.reduce((result, d) => {
              let currentDest = result[d.cityid] || {
                  'cityid': d.cityid,
                  'cidade': d.cidade,
                  'lat': +d.lat,
                  'long': +d.long,
                  'diasfrom': +d.diasfrom,
                  'Count': 0,
                  'first_tweet': +d.diasfrom
              };

              currentDest.Count += 1;
              
              if( result[d.cityid] )
                  currentDest.first_tweet = Math.min(currentDest.first_tweet, result[d.cityid].first_tweet);
              result[d.cityid] = currentDest;
              return result;
          }, {});

          result = Object.keys(result).map(key => result[key]);
          return result;
      }

      function loadData() {
          return Promise.all([
              d3.json('geo/sp.geo.json'),
              d3.csv('data/cases-sp-cities.csv'),
              d3.csv('data/evolucao_casos.csv'),
              d3.csv('data/geoMap.csv'),
              d3.csv('data/all_tweets.csv')
          ]).then(datasets => {

              store.geoJSON = datasets[0];

              casosByCity = datasets[1];
              store.evolucao = datasets[2];
              googleTrendsMap = datasets[3];

              store.tweets = datasets[4].filter(d => {

                  let temp = d.date.split(" ")[0].split("-");
                  let date = new Date(+temp[0], +temp[1] - 1, +temp[2]);
                  // tweets[i].data = new Date(+temp[0], +temp[1] - 1, +temp[2]);

                  return date >= new Date(2020, 1, 27);
              });

              // cityid,cidade,lat,long,diasfrom,date,




              // mais tarde

              // let first_date = ""; 

              
              // let map_date = {};

              // let all_tweets_normalized = [];


              // for( let j = 0; j < store.tweets.length; ++j ) {
              //   // console.log("hello "+j);
              //   let date = store.tweets[j].date.split(" ")[0];

              //   console.log(first_date+" != "+date);
              //   if( first_date != date ) {

              //     console.log('entrei aqui');
              //     console.log(Object.keys(map_date).map(key => map_date[key]));
              //     first_date = date;
                  

              //     all_tweets_normalized = all_tweets_normalized.concat(Object.keys(map_date).map(key => map_date[key]));
              //     map_date = {};
              //     store.geoJSON.features.forEach(function(d, i) {
              //       let centroid = d3.geoCentroid(d);
              //       map_date[d.properties.name.replace(/[^\x00-\x7F]/g, "")] = {
              //         'cityid': i,
              //         'cidade': d.properties.name,
              //         'lat': +centroid[0],
              //         'long': +centroid[1],
              //         'Count': 0,
              //         'date': store.tweets[i].date
              //       }
              //     });
              //   }

              //   for( let i = 0; i < store.geoJSON.features.length; ++i ) {
              //     if( d3.geoContains(store.geoJSON.features[i], [+store.tweets[i].long, +store.tweets[i].lat]) ) {
              //       map_date[store.geoJSON.features[i].properties.name.replace(/[^\x00-\x7F]/g, "")].Count += 1;
              //       break;
              //     }
              //   } 
                
              // }
              // console.log('all_tweets_normalized');
              // console.log(all_tweets_normalized);

              


              // for( let i = 0; i < polygons.length; ++i ) {
              //   console.log('Is '+store.tweets[0].cidade+' in '+polygons[i].properties.name+'? '+);
              //   // console.log(polygons[i]);
              //   console.log(d3.geoContains(polygons[i].geometry, [+store.tweets[0].lat, +store.tweets[0].long]))
              //   // console.log([+store.tweets[0].lat, +store.tweets[0].long]);
              //   // console.log(polygons[i]);
              //   // if( d3.geoContains(polygons[i], [+store.tweets[0].lat, +store.tweets[0].long]) ) {
              //   //     console.log("yes");
              //   // } else
              //   //   console.log('no');

              // }



              // store.geoJSON.features.forEach(function(d, i) {
              //   map_date[d.properties.name] =
              // });





              // console.log('map_date')
              // console.log(map_date);
              // console.log(Object.keys(map_date).map(key => map_date[key]));






              // store.geoJSON.features.forEach(function(d) {

              //     if( d3.geoContains(d, [+store.tweets[0].long, +store.tweets[0].lat]) ) {
              //       console.log("ACHEI");
              //       console.log(d);
              //       console.log(store.tweets);
              //     }else
              //       console.log("não achei")
              // });

              // let polygons = store.geoJSON.features;
              // for( let i = 0; i < polygons.length; ++i ) {
              //   console.log('Is '+store.tweets[0].cidade+' in '+polygons[i].properties.name+'? '+d3.geoContains(polygons[i], [+store.tweets[0].lat, +store.tweets[0].long]));
              //   // console.log(polygons[i]);
              //   console.log(d3.geoContains(polygons[i].geometry, [+store.tweets[0].lat, +store.tweets[0].long]))
              //   // console.log([+store.tweets[0].lat, +store.tweets[0].long]);
              //   // console.log(polygons[i]);
              //   // if( d3.geoContains(polygons[i], [+store.tweets[0].lat, +store.tweets[0].long]) ) {
              //   //     console.log("yes");
              //   // } else
              //   //   console.log('no');

              // }


              lastDate = new Date(2020, 0, 1);
              let temp = "";

              for( let i = 0; i < casosByCity.length; i++ ) {

                  let date_string = casosByCity[i].data.split('/');
                  let day = +date_string[0];

                  let month = map_month[date_string[1]];

                  let date = new Date(2020, month-1, day);
                  if( date > lastDate ) {
                      lastDate = date;
                  }

                  casosByCity[i].date = date;
              }

              let googleTrendsMapLastDate = new Date(2020, 0, 1);


              for( let i = 0; i < googleTrendsMap.length; ++i ) {
                    let date_string = googleTrendsMap[i].ate.split('/');
                    let day = +date_string[0];

                    let month = map_month[date_string[1]];

                    let date = new Date(2020, month-1, day);
                    if( date > googleTrendsMapLastDate ) {
                        googleTrendsMapLastDate = date;
                        temp = googleTrendsMap[i].ate;
                    }

                    googleTrendsMap[i]['tosse'] = +googleTrendsMap[i]['tosse'];
                    googleTrendsMap[i]['febre'] = +googleTrendsMap[i]['febre'];
                    googleTrendsMap[i]['tosse seca'] = +googleTrendsMap[i]['tosse seca'];
                    googleTrendsMap[i]['febre alta'] = +googleTrendsMap[i]['febre alta'];
                    googleTrendsMap[i]['falta de ar'] = +googleTrendsMap[i]['falta de ar'];
                    googleTrendsMap[i]['lat'] = +googleTrendsMap[i]['lat'];
                    googleTrendsMap[i]['long'] = +googleTrendsMap[i]['long'];

                    googleTrendsMap[i]['id'] = i;

                    googleTrendsMap[i].date = date;
                }

                colors = d3.scaleOrdinal(d3.schemeCategory10)
                  .domain(googleTrendsMap.columns.slice(2, 7));

                subsetGoogleTrendsMap = googleTrendsMap.filter(d => d.ate == temp);
                document.getElementById('progressionGoogleTrends').innerHTML = "Dia: "+temp;
              

              return store;
          })
      }

      function getMapConfig(map) {
          let container = d3.select(map);

          container
              .attr('width', width)
              .attr('height', height)

          return {width, height, container};
      }

      function getMapProjection(config, geoJson) {
          let {width, height} = config;
          let projection = d3.geoMercator();

          var center = d3.geoCentroid(geoJson);
          var scale = 10;
          var offset = [width/2, height/2];
          projection = d3.geoMercator().scale(scale)
              .center(center)
              .translate(offset);

          let path = d3.geoPath()
              .projection(projection);

          var bounds = path.bounds(geoJson)
          var hscale  = scale*width  / (bounds[1][0] - bounds[0][0]);
          var vscale  = scale*height / (bounds[1][1] - bounds[0][1]);
          var scale   = (hscale < vscale) ? hscale : vscale;
          var offset  = [width - (bounds[0][0] + bounds[1][0])/2,
                          height - (bounds[0][1] + bounds[1][1])/2];

          // new projection
          projection = d3.geoMercator().center(center)
              .scale(scale).translate(offset);

          store.mapProjection = projection;

          return projection;
      }

      function updateProgressionMap(value) {
          let countDifferent = 0;
          let targetDate = casosByCity[0].data;

          for (var i = 0; i < casosByCity.length; i++) {

              if( value == countDifferent ) {
                  targetDate = casosByCity[i].data;
                  break;
              }

              if( targetDate != casosByCity[i].data ) {
                  countDifferent += 1;
                  targetDate = casosByCity[i].data;
              }
          }

          let subset = casosByCity.filter(d => d.data == targetDate);
          drawBaseMapReal(configMapReal.container, geoJson.features, projectionMapReal, geoJson, subset, true);


          document.getElementById('titleProgression').innerHTML = 'Dia: '+targetDate+'.';
      }

      document.getElementById('progression-front').addEventListener('click', () => {
        if( progressionDay < progressionDayMax ) {
          updateProgressionMap(++progressionDay);
          document.getElementById('progression-back').disabled = false;
          if( progressionDay == progressionDayMax )
              document.getElementById('progression-front').disabled = true;
        }
      });

      document.getElementById('progression-back').addEventListener('click', () => {
        if( progressionDay > 0 ) {
          updateProgressionMap(--progressionDay);
          document.getElementById('progression-front').disabled = false;
          if( progressionDay == 0 )
              document.getElementById('progression-back').disabled = true;
        } 
      });

      function updateTwitterMap(days) {
          let one_day = 1000*60*60*24;
          let object = null;
          for( let i = 0; i < allTweets.length; ++i ) {

              let value = Math.round(allTweets[i].date_object-(new Date(2020, 1, 27)))/one_day;

              if( value == days ) {
                  date = allTweets[i].date_object;
                  object = allTweets[i];
                  break;
              }
          }

          let subsetTwitter = allTweets.filter(d => d.date_object.getDay() == date.getDay() &&
                                               d.date_object.getMonth() == date.getMonth() &&
                                               d.date_object.getYear() == date.getYear());
          drawSubsetTweets(subsetTwitter, store, true);
          document.getElementById('progressionTwitter').innerHTML = 'Dia: '+object.date.split(" ")[0].split("-")[2]+"/"+number_to_month[+object.date.split(" ")[0].split("-")[1] - 1];
      }


      document.getElementById('twitter-front').addEventListener('click', () => {
        if( twitterDay < twitterDayMax ) {
          updateTwitterMap(++twitterDay);
          document.getElementById('twitter-back').disabled = false;
          if( twitterDay == twitterDayMax )
              document.getElementById('twitter-front').disabled = true;
        }
      });

      document.getElementById('twitter-back').addEventListener('click', () => {
        if( twitterDay > 0 ) {
          updateTwitterMap(--twitterDay);
          document.getElementById('twitter-front').disabled = false;
          if( twitterDay == 0 )
              document.getElementById('twitter-back').disabled = true;
        } 
      });


      function updateGoogleMap(value) {
        let countDifferent = 0;
        let targetDate = googleTrendsMap[0].ate;

        for (var i = 0; i < googleTrendsMap.length; i++) {

            if( value == countDifferent ) {
                targetDate = googleTrendsMap[i].ate;
                break;
            }

            if( targetDate != googleTrendsMap[i].ate ) {
                countDifferent += 1;
                targetDate = googleTrendsMap[i].ate;
            }
        }

        subsetGoogleTrendsMap = googleTrendsMap.filter(d => d.ate == targetDate);

        drawGoogleTrends(colorTrends, termTrends);
        document.getElementById('progressionGoogleTrends').innerHTML = 'Dia: '+targetDate+'.';
      }


      document.getElementById('google-front').addEventListener('click', () => {
        if( googleDay < googleDayMax ) {
          updateGoogleMap(++googleDay);
          document.getElementById('google-back').disabled = false;
          if( googleDay == googleDayMax )
              document.getElementById('google-front').disabled = true;
        }
      });

      document.getElementById('google-back').addEventListener('click', () => {
        if( googleDay > 0 ) {
          updateGoogleMap(--googleDay);
          document.getElementById('google-front').disabled = false;
          if( googleDay == 0 )
              document.getElementById('google-back').disabled = true;
        } 
      });



      document.getElementById('dateGoogleTrends').addEventListener('input', function() {
          let value = this.value;
          googleDay = value;
          if( googleDay == 0 ) {
              document.getElementById('google-back').disabled = true; 
              document.getElementById('google-front').disabled = false; 
          } else if( googleDay == googleDayMax ) {
              document.getElementById('google-back').disabled = false; 
              document.getElementById('google-front').disabled = true; 
          } else {
              document.getElementById('google-back').disabled = false; 
              document.getElementById('google-front').disabled = false; 
          }

          let countDifferent = 0;
          let targetDate = googleTrendsMap[0].ate;

          for (var i = 0; i < googleTrendsMap.length; i++) {

              if( value == countDifferent ) {
                  targetDate = googleTrendsMap[i].ate;
                  break;
              }

              if( targetDate != googleTrendsMap[i].ate ) {
                  countDifferent += 1;
                  targetDate = googleTrendsMap[i].ate;
              }
          }

          subsetGoogleTrendsMap = googleTrendsMap.filter(d => d.ate == targetDate);

          drawGoogleTrends(colorTrends, termTrends);
          document.getElementById('progressionGoogleTrends').innerHTML = 'Dia: '+targetDate+'.';
      });

      document.getElementById('realProgression').addEventListener('input', function() {
          let value = this.value;
          progressionDay = value;
          if( progressionDay == 0 ) {
              document.getElementById('progression-back').disabled = true; 
              document.getElementById('progression-front').disabled = false; 
          } else if( progressionDay == progressionDayMax ) {
              document.getElementById('progression-back').disabled = false; 
              document.getElementById('progression-front').disabled = true; 
          } else {
              document.getElementById('progression-back').disabled = false; 
              document.getElementById('progression-front').disabled = false; 
          }


          let countDifferent = 0;
          let targetDate = casosByCity[0].data;

          for (var i = 0; i < casosByCity.length; i++) {

              if( value == countDifferent ) {
                  targetDate = casosByCity[i].data;
                  break;
              }

              if( targetDate != casosByCity[i].data ) {
                  countDifferent += 1;
                  targetDate = casosByCity[i].data;
              }
          }

          let subset = casosByCity.filter(d => d.data == targetDate);
          drawBaseMapReal(configMapReal.container, geoJson.features, projectionMapReal, geoJson, subset, true);


          document.getElementById('titleProgression').innerHTML = 'Dia: '+targetDate+'.';
      });

      document.getElementById('dateTwitter').addEventListener('input', function() {
          let days = this.value;
          twitterDay = days;
          if( twitterDay == 0 ) {
              document.getElementById('twitter-back').disabled = true; 
              document.getElementById('twitter-front').disabled = false; 
          } else if( twitterDay == twitterDayMax ) {
              document.getElementById('twitter-back').disabled = false; 
              document.getElementById('twitter-front').disabled = true; 
          } else {
              document.getElementById('twitter-back').disabled = false; 
              document.getElementById('twitter-front').disabled = false; 
          }


          let one_day = 1000*60*60*24;
          let object = null;
          for( let i = 0; i < allTweets.length; ++i ) {

              let value = Math.round(allTweets[i].date_object-(new Date(2020, 1, 27)))/one_day;

              if( value == days ) {
                  date = allTweets[i].date_object;
                  object = allTweets[i];
                  break;
              }
          }

          let subsetTwitter = allTweets.filter(d => d.date_object.getDay() == date.getDay() &&
                                               d.date_object.getMonth() == date.getMonth() &&
                                               d.date_object.getYear() == date.getYear());
          drawSubsetTweets(subsetTwitter, store, true);
          document.getElementById('progressionTwitter').innerHTML = 'Dia: '+object.date.split(" ")[0].split("-")[2]+"/"+number_to_month[+object.date.split(" ")[0].split("-")[1] - 1];
      });
      
    </script>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.96cf4c3dc37ea60dbbd03c13a455f1f7.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  


  <p class="powered-by">
    
    <img src="unesp.svg" width="100" height="50" style="position: absolute; margin: auto; right: 0; left: 0;" /><br/>
    <strong>Faculdade de Ciências e Tecnologia - Câmpus de Presidente Prudente</strong><br/>
    Rua Roberto Simonsen, 305 - Centro Educacional - P. Prudente/SP - CEP 19060-900<br/>
    Telefone: (18) 3229-5388


   <!--  Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>. -->

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
